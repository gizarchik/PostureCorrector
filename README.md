# PostureCorrector
Устройство с микроконтроллером, которое с помощью модели машинного обучения сигнализирует о нарушении осанки.

## Задача
1) Обучить модель для развертывания на смартфоне. Данные с устройства передаются через Bluetooth.
Больших ограничений по ресурсам и использованию технологий нет.

3) Обучить модель для развертывания на микроконтроллере. 
В этом случае реализация предсказания должна быть написана на языке C.
Производительность слабая, объем памяти (только оперативной) - 256 МБ.

## Датасет
Данные собраны вручную с 39 человек. Необработанные данные представляют собой временной ряд показаний акселерометра и гироскопа в трёх измерениях (x, y, z).
Показания считались в трёх позициях: сидя, стоя и в ходьбе. Целевой признак - согнутое или прямое положение.

По окнам размера 100 и шагом 25 измерений посчитаны метрики: `mean`, `std`, `min`, `max`, `energy`, `correlation`, `sma`, `iqr`. 
Также для улучшения точности, чтобы корректор учитывал особенности каждого человека, использовались предпосчитанные 
метрики в сидячем прямом положении. То есть половина метрик считаются онлайн, половина уже предпосчитана. 
Всего **48 признаков** в датасете.

## Описание
### Задача 1
Для развертывания на телефоне был выбран **CatBoost**. **Точность** при использовании всех 48 метрик - **0.998, время предсказания - 0.32 мс**.
После отбора признаков можно использовать 5 метрик. Точность - **0.989, время предсказания - 0.27 мс**.
### Задача 2
Целью этой задачи было подобрать модель, которую проще всего будет реализовать на языке C.
Поэтому были выбраны модели SVM и логистическая регрессия. 

**LogReg** является линейным классификатором, поэтому лучшая **точность** с добавлением новых метрик - **0.85**. Этот вариант отбросился.

Самописный **SVM с rbf ядром** с полным набором признаков имеет **точность - 0.99**. 
Но для предсказания модели нужно хранить всю обучающую выборку, а память ограничена.
Поэтому было использовано только 30% общей выборки - это не сильно влияет, так как данные считывались в течение двух минут,
и схожих элементов выборок большое число. Также была применена квантизация до float16.
Итоговая **точность** получилась - **0.95**

### Дополнительные исследования и эксперименты: 
- Если пользоваться только данными, которые поступают онлайн, то есть без использования метрик, которые 
предпосчитываются на человеке до использования устройства, то **точность** получается - **0.70**. Посчитано на CatBoost.
- Было вывлено, что размер окна, на котором считаются метрики, практически влияют на точность.
Были протестированы разные размеры окна: 50, 100, 150, 200. Но так как данные с датчика поступают каждые 20мс, то
был выбран размер - 100, шаг - 50. То есть предсказание моделью осуществляются каждую секунду.
- Порядок времени подсчета одной метрики из сырых данных - **0.01 мс**. То есть отбор признаков позволяет еще
уменьшить время предсказания почти в два раза.
- Был рассмотрен другой подход к решению: сначала определять позицию человека, а потом определять его осанку.
Но в ходе эксперимента было выявлено, что такой подход уменьшает точность.
Например, при использовании SVM точность определения позиции составляла 0.97,
а последующая точность определения осанки 0.98 - 0.99. А без этого трюка точность составляет и так 0.99.
К тому же для этого нужно обучать еще одну модель, что добаляет лишнюю сложность. 
